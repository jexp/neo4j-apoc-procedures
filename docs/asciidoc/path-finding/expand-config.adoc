[[path-expander-paths-config]]
== Expand paths with config

[abstract]
--
This section describes a procedure that can be used to expand the paths of variable length path traversals, while providing configuration options.
--

The expand paths with config procedure enables powerful variable length path traversals with fine grained control over the traversals.
See <<path-expander-paths>> for a more basic version of the algorithm if fine grained control over traversals isn't required.

This section includes:

* <<path-expander-paths-config-overview>>
* <<path-expander-paths-config-config>>
* <<path-expander-paths-config-config-sequences>>
* <<path-expander-paths-config-examples>>

[[path-expander-paths-config-overview]]
=== Procedure Overview

The procedure is described below:

[separator=Â¦,opts=header,cols="1,1m,1m,5"]
|===
include::../../../build/generated-documentation/apoc.path.expandConfig.csv[]
|===

[[path-expander-paths-config-config]]
=== Configuration parameters
The procedures support the following config parameters:

.Config parameters
[opts=header]
|===
| name | type | default | description
| minLevel | Long | -1 | the minimum number of hops in the traversal
| maxLevel | Long | -1 | the maximum number of hops in the traversal
| relationshipFilter | String | null | the relationship types and directions to traverse. See <<path-expander-paths-config-config-relationship-filters>>.
| labelFilter | String | null | the node labels to traverse. See <<path-expander-paths-config-config-label-filters>>.
| sequence | String | null | comma-separated alternating label and relationship filters, for each step in a repeating sequence.
If present, `labelFilter`, and `relationshipFilter` are ignored, as this takes priority.
See <<path-expander-paths-config-config-sequences>>.
| beginSequenceAtStart | Boolean | true | starts matching sequences of node labels and/or relationship types (defined in `relationshipFilter`, `labelFilter`, or `sequences`) one node away from the start node.
| uniqueness | String | RELATIONSHIP_PATH | the strategy to use when expanding relationships in a traversal. See <<path-expander-paths-config-config-uniqueness>>.
| bfs | Boolean | true | use Breadth First Search when traversing. Uses Depth First Search if set to `false`
| filterStartNode | Boolean | false | whether the `labelFilter` and `sequence` apply to the start node of the expansion.
| limit | Long | -1 | limit the number of paths returned. When using `bfs:true`, this has the effect of returning paths to the `n` nearest nodes with labels in the termination or end node filter, where `n` is the limit given.
| optional | Boolean | false | is path expansion optional?
If set to `true`, a `null` value is yielded whenever the expansion would normally eliminate rows due to no results.
| endNodes | List<Node> | null | only these nodes can end returned paths, and expansion will continue past these nodes, if possible.
| terminatorNodes | List<Node> | null | Only these nodes can end returned paths, and expansion won't continue past these nodes.
| whiteListNodes | List<Node> | null | Only these nodes are allowed in the expansion (though endNodes and terminatorNodes will also be allowed, if present).
| blackListNodes | List<Node> | null | None of the paths returned will include these nodes.
|===

[[path-expander-paths-config-config-relationship-filters]]
==== Relationship Filters

The syntax for relationship filters is described below:

include::relationship-filter.adoc[]

[[path-expander-paths-config-config-label-filters]]
==== Label Filters

The syntax for label filters is described below:

include::label-filter.adoc[]

*Label filter operator precedence and behavior*

include::label-filter-precedence.adoc[]

[[path-expander-paths-config-config-uniqueness]]
==== Uniqueness

include::uniqueness-expand.adoc[]

[[path-expander-paths-config-config-sequences]]
=== Specifying Sequences of node labels and relationship types

include::sequences.adoc[]
include::sequence-tips.adoc[]

[[path-expander-paths-config-examples]]
=== Examples

.Termination and end node label filter example

We will first set a `:Western` label on some nodes.

[source,cypher]
----
match (p:Person)
where p.name in ['Clint Eastwood', 'Gene Hackman']
set p:Western
----

Now expand from 'Keanu Reeves' to all `:Western` nodes with a termination filter:

[source,cypher]
----
match (k:Person {name:'Keanu Reeves'})
call apoc.path.expandConfig(k, {relationshipFilter:'ACTED_IN|PRODUCED|DIRECTED', labelFilter:'/Western', uniqueness: 'NODE_GLOBAL'}) yield path
return path
----

The one returned path only matches up to 'Gene Hackman'.
While there is a path from 'Keanu Reeves' to 'Clint Eastwood' through 'Gene Hackman', no further expansion is permitted through a node in the termination filter.

If you didn't want to stop expansion on reaching 'Gene Hackman', and wanted 'Clint Eastwood' returned as well, use the end node filter  instead (`>`).

You can turn this cypher query:

[source,cypher]
----
MATCH (user:User) WHERE user.id = 460
MATCH (user)-[:RATED]->(movie)<-[:RATED]-(collab)-[:RATED]->(reco)
RETURN count(*);
----

into this procedure call, with changed semantics for uniqueness and bfs (which is Cypher's expand mode)

[source,cypher]
----
MATCH (user:User) WHERE user.id = 460
CALL apoc.path.expandConfig(user,{
    relationshipFilter:"RATED",
    minLevel:3,
    maxLevel:3,
    bfs:false,
    uniqueness:"NONE"
})
YIELD path
RETURN count(*);
----
